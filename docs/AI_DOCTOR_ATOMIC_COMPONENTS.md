# ü§ñ Types et Composants Atomiques AI Doctor - Limitless Health

## üéØ Objectif

Cr√©er une architecture de types et composants atomiques sp√©cifiques √† l'AI Doctor, en assurant une exp√©rience utilisateur coh√©rente et professionnelle pour les interactions avec l'intelligence artificielle en sant√©.

## üìÅ Structure des Fichiers

### 1. **Types AI Doctor** (`src/shared/types/ai-doctor.ts`)

```
src/shared/types/ai-doctor.ts
‚îú‚îÄ‚îÄ ChatMessage              # Messages de chat
‚îú‚îÄ‚îÄ ChatFile                 # Fichiers de chat
‚îú‚îÄ‚îÄ AIRecommendation         # Recommandations IA
‚îú‚îÄ‚îÄ AIAnalysis               # Analyses IA
‚îú‚îÄ‚îÄ MessageProps             # Props des messages
‚îú‚îÄ‚îÄ ChatInputProps           # Props des entr√©es de chat
‚îú‚îÄ‚îÄ RecommendationCardProps  # Props des cartes de recommandation
‚îú‚îÄ‚îÄ ConfidenceBarProps       # Props des barres de confiance
‚îî‚îÄ‚îÄ ...                      # Autres types
```

### 2. **Composants Atomiques AI Doctor** (`src/shared/ui/`)

```
src/shared/ui/
‚îú‚îÄ‚îÄ AtomicMessage.tsx              # Message de chat atomique
‚îú‚îÄ‚îÄ AtomicChatInput.tsx            # Entr√©e de chat atomique
‚îú‚îÄ‚îÄ AtomicRecommendationCard.tsx   # Carte de recommandation atomique
‚îú‚îÄ‚îÄ AtomicConfidenceBar.tsx        # Barre de confiance atomique
‚îî‚îÄ‚îÄ index.ts                       # Export des composants
```

## üèóÔ∏è Architecture des Types

### 1. **Types de Base pour le Chat IA**

#### ‚úÖ **ChatMessage**

```typescript
export interface ChatMessage {
  id: string;
  content: string;
  role: 'user' | 'assistant' | 'system';
  timestamp: Date;
  file?: ChatFile;
  metadata?: {
    confidence?: number;
    category?: string;
    urgency?: 'low' | 'medium' | 'high' | 'critical';
    processingTime?: number;
    tokens?: number;
  };
}
```

#### ‚úÖ **ChatFile**

```typescript
export interface ChatFile {
  name: string;
  size: number;
  type: string;
  url?: string;
  id?: string;
  uploadDate?: Date;
  status?: 'uploading' | 'uploaded' | 'error' | 'processing';
  progress?: number;
}
```

#### ‚úÖ **AIRecommendation**

```typescript
export interface AIRecommendation {
  id: string;
  recommendation: string;
  confidence: number;
  category:
    | 'lifestyle'
    | 'medical'
    | 'nutrition'
    | 'exercise'
    | 'mental'
    | 'preventive';
  urgency: 'low' | 'medium' | 'high' | 'critical';
  timestamp: string;
  source?: string;
  evidence?: string[];
  relatedBiomarkers?: string[];
  priority?: number;
  actionable?: boolean;
  followUp?: {
    timeframe: string;
    action: string;
    reminder?: boolean;
  };
}
```

#### ‚úÖ **AIAnalysis**

```typescript
export interface AIAnalysis {
  id: string;
  userId: string;
  timestamp: string;
  input: {
    text: string;
    files?: ChatFile[];
    context?: {
      symptoms?: string[];
      medications?: string[];
      conditions?: string[];
      recentTests?: string[];
    };
  };
  output: {
    summary: string;
    recommendations: AIRecommendation[];
    confidence: number;
    processingTime: number;
    model: string;
    version: string;
  };
  status: 'pending' | 'processing' | 'completed' | 'error';
  error?: string;
}
```

### 2. **Types pour les Composants de Chat**

#### ‚úÖ **MessageProps**

```typescript
export interface MessageProps {
  message: ChatMessage;
  variant?: 'default' | 'compact' | 'detailed';
  size?: 'sm' | 'md' | 'lg';
  showTimestamp?: boolean;
  showAvatar?: boolean;
  showMetadata?: boolean;
  onFileClick?: (file: ChatFile) => void;
  onRetry?: (messageId: string) => void;
  className?: string;
  style?: React.CSSProperties;
}
```

#### ‚úÖ **ChatInputProps**

```typescript
export interface ChatInputProps {
  value: string;
  onChange: (value: string) => void;
  onSend: () => void;
  onFileUpload?: (files: File[]) => void;
  onVoiceRecord?: () => void;
  placeholder?: string;
  disabled?: boolean;
  loading?: boolean;
  maxLength?: number;
  showFileUpload?: boolean;
  showVoiceRecord?: boolean;
  showSendButton?: boolean;
  autoFocus?: boolean;
  className?: string;
  style?: React.CSSProperties;
}
```

### 3. **Types pour les Composants de Recommandations**

#### ‚úÖ **RecommendationCardProps**

```typescript
export interface RecommendationCardProps {
  recommendation: AIRecommendation;
  variant?: 'default' | 'compact' | 'detailed' | 'actionable';
  size?: 'sm' | 'md' | 'lg';
  showConfidence?: boolean;
  showCategory?: boolean;
  showUrgency?: boolean;
  showTimestamp?: boolean;
  showActions?: boolean;
  onAction?: (action: string, recommendationId: string) => void;
  onDismiss?: (recommendationId: string) => void;
  onFollowUp?: (recommendationId: string) => void;
  className?: string;
  style?: React.CSSProperties;
}
```

#### ‚úÖ **ConfidenceBarProps**

```typescript
export interface ConfidenceBarProps {
  confidence: number;
  variant?: 'default' | 'gradient' | 'animated';
  size?: 'sm' | 'md' | 'lg';
  showLabel?: boolean;
  showValue?: boolean;
  showPercentage?: boolean;
  color?: string;
  animated?: boolean;
  className?: string;
  style?: React.CSSProperties;
}
```

### 4. **Types pour les √âtats et Actions**

#### ‚úÖ **ChatState**

```typescript
export interface ChatState {
  messages: ChatMessage[];
  isLoading: boolean;
  error: string | null;
  uploadedFiles: ChatFile[];
  isTyping: boolean;
  typingMessage?: string;
  lastActivity: Date;
}
```

#### ‚úÖ **ChatActions**

```typescript
export interface ChatActions {
  addMessage: (message: Omit<ChatMessage, 'id' | 'timestamp'>) => void;
  updateMessage: (messageId: string, updates: Partial<ChatMessage>) => void;
  removeMessage: (messageId: string) => void;
  setLoading: (loading: boolean) => void;
  setError: (error: string | null) => void;
  addFile: (file: File) => void;
  removeFile: (fileId: string) => void;
  clearChat: () => void;
  setTyping: (isTyping: boolean, message?: string) => void;
  sendMessage: (message: string, files?: File[]) => Promise<void>;
  retryMessage: (messageId: string) => Promise<void>;
}
```

## üß© Composants Atomiques AI Doctor

### 1. **AtomicMessage** - Message de Chat IA

#### ‚úÖ **Fonctionnalit√©s**

- **Variants** : `default`, `compact`, `detailed`
- **Tailles** : `sm`, `md`, `lg`
- **Th√®me adaptatif** : Light/Dark mode
- **Avatars** : Utilisateur et IA Assistant
- **Fichiers joints** : Affichage avec ic√¥nes et tailles
- **M√©tadonn√©es** : Confiance, temps de traitement, tokens
- **Actions** : Retry pour les messages IA

#### ‚úÖ **Utilisation**

```typescript
import { AtomicMessage } from '../shared/ui/AtomicMessage';

<AtomicMessage
  message={{
    id: '1',
    content: 'Bonjour, comment puis-je vous aider aujourd\'hui ?',
    role: 'assistant',
    timestamp: new Date(),
    metadata: {
      confidence: 0.95,
      processingTime: 1200,
      tokens: 15
    }
  }}
  variant="detailed"
  size="lg"
  showMetadata
  onRetry={(messageId) => console.log('Retry message:', messageId)}
/>
```

#### ‚úÖ **Props Principales**

- `message` - Donn√©es du message
- `variant` - Style d'affichage (default, compact, detailed)
- `size` - Taille du composant (sm, md, lg)
- `showTimestamp` - Afficher l'horodatage
- `showAvatar` - Afficher les avatars
- `showMetadata` - Afficher les m√©tadonn√©es
- `onFileClick` - Callback pour clic sur fichier
- `onRetry` - Callback pour retry de message

### 2. **AtomicChatInput** - Entr√©e de Chat IA

#### ‚úÖ **Fonctionnalit√©s**

- **Saisie multiligne** avec compteur de caract√®res
- **T√©l√©chargement de fichiers** avec pr√©visualisation
- **Enregistrement vocal** avec indicateur d'√©tat
- **Validation** et limites de caract√®res
- **√âtats de chargement** et d√©sactivation
- **Raccourcis clavier** (Entr√©e pour envoyer)

#### ‚úÖ **Utilisation**

```typescript
import { AtomicChatInput } from '../shared/ui/AtomicChatInput';

<AtomicChatInput
  value={message}
  onChange={setMessage}
  onSend={handleSendMessage}
  onFileUpload={handleFileUpload}
  onVoiceRecord={handleVoiceRecord}
  placeholder="D√©crivez vos sympt√¥mes..."
  maxLength={1000}
  showFileUpload
  showVoiceRecord
  loading={isLoading}
/>
```

#### ‚úÖ **Props Principales**

- `value` - Valeur du message
- `onChange` - Callback de changement
- `onSend` - Callback d'envoi
- `onFileUpload` - Callback de t√©l√©chargement de fichiers
- `onVoiceRecord` - Callback d'enregistrement vocal
- `maxLength` - Limite de caract√®res
- `showFileUpload` - Afficher le bouton de fichiers
- `showVoiceRecord` - Afficher le bouton vocal
- `loading` - √âtat de chargement

### 3. **AtomicRecommendationCard** - Carte de Recommandation IA

#### ‚úÖ **Fonctionnalit√©s**

- **Variants** : `default`, `compact`, `detailed`, `actionable`
- **Tailles** : `sm`, `md`, `lg`
- **Cat√©gories** : Lifestyle, Medical, Nutrition, Exercise, Mental, Preventive
- **Niveaux d'urgence** : Low, Medium, High, Critical
- **Barre de confiance** int√©gr√©e
- **Actions** : Appliquer, Ignorer, Planifier un suivi
- **Suivi** : Informations de suivi recommand√©

#### ‚úÖ **Utilisation**

```typescript
import { AtomicRecommendationCard } from '../shared/ui/AtomicRecommendationCard';

<AtomicRecommendationCard
  recommendation={{
    id: 'rec-001',
    recommendation: 'Buvez plus d\'eau et faites 30 min d\'activit√© physique aujourd\'hui !',
    confidence: 0.92,
    category: 'lifestyle',
    urgency: 'medium',
    timestamp: new Date().toISOString(),
    actionable: true,
    followUp: {
      timeframe: '1 semaine',
      action: 'Contr√¥ler la tension art√©rielle',
      reminder: true
    }
  }}
  variant="actionable"
  size="lg"
  showConfidence
  showCategory
  showUrgency
  onAction={(action, id) => console.log('Action:', action, id)}
  onFollowUp={(id) => console.log('Follow up:', id)}
/>
```

#### ‚úÖ **Props Principales**

- `recommendation` - Donn√©es de la recommandation
- `variant` - Style d'affichage (default, compact, detailed, actionable)
- `size` - Taille du composant (sm, md, lg)
- `showConfidence` - Afficher la barre de confiance
- `showCategory` - Afficher la cat√©gorie
- `showUrgency` - Afficher le niveau d'urgence
- `onAction` - Callback pour actions
- `onDismiss` - Callback pour ignorer
- `onFollowUp` - Callback pour suivi

### 4. **AtomicConfidenceBar** - Barre de Confiance IA

#### ‚úÖ **Fonctionnalit√©s**

- **Variants** : `default`, `gradient`, `animated`
- **Tailles** : `sm`, `md`, `lg`
- **Couleurs automatiques** selon le niveau de confiance
- **Labels intelligents** : Tr√®s √©lev√©e, √âlev√©e, Mod√©r√©e, Faible, Tr√®s faible
- **Animations** : Striped et animated
- **Personnalisation** : Couleurs et labels personnalisables

#### ‚úÖ **Utilisation**

```typescript
import { AtomicConfidenceBar } from '../shared/ui/AtomicConfidenceBar';

<AtomicConfidenceBar
  confidence={0.85}
  variant="gradient"
  size="lg"
  showLabel
  showValue
  showPercentage
  animated
/>
```

#### ‚úÖ **Props Principales**

- `confidence` - Niveau de confiance (0-1)
- `variant` - Style visuel (default, gradient, animated)
- `size` - Taille du composant (sm, md, lg)
- `showLabel` - Afficher le label
- `showValue` - Afficher la valeur
- `showPercentage` - Afficher le pourcentage
- `color` - Couleur personnalis√©e
- `animated` - Animation de la barre

## üîß Utilisation dans les Composants AI Doctor

### 1. **Chat IA avec Composants Atomiques**

```typescript
import React, { useState } from 'react';
import { Container, Stack, ScrollArea } from '@mantine/core';
import {
  AtomicMessage,
  AtomicChatInput,
  AtomicRecommendationCard,
  AtomicConfidenceBar,
} from '../shared/ui';
import { ChatMessage, AIRecommendation } from '../shared/types';

const AIChat: React.FC = () => {
  const [messages, setMessages] = useState<ChatMessage[]>([]);
  const [inputValue, setInputValue] = useState('');
  const [recommendations, setRecommendations] = useState<AIRecommendation[]>([]);

  const handleSendMessage = () => {
    if (inputValue.trim()) {
      // Logique d'envoi du message
      setInputValue('');
    }
  };

  return (
    <Container size="lg" py="xl">
      <Stack gap="xl">
        {/* Messages de chat */}
        <ScrollArea h={400}>
          <Stack gap="md">
            {messages.map((message) => (
              <AtomicMessage
                key={message.id}
                message={message}
                variant="detailed"
                showMetadata
                onRetry={(messageId) => console.log('Retry:', messageId)}
              />
            ))}
          </Stack>
        </ScrollArea>

        {/* Recommandations IA */}
        {recommendations.length > 0 && (
          <Stack gap="md">
            <AtomicConfidenceBar
              confidence={0.92}
              variant="gradient"
              size="lg"
              showLabel
              showValue
            />
            {recommendations.map((recommendation) => (
              <AtomicRecommendationCard
                key={recommendation.id}
                recommendation={recommendation}
                variant="actionable"
                showConfidence
                onAction={(action, id) => console.log('Action:', action, id)}
              />
            ))}
          </Stack>
        )}

        {/* Entr√©e de chat */}
        <AtomicChatInput
          value={inputValue}
          onChange={setInputValue}
          onSend={handleSendMessage}
          placeholder="D√©crivez vos sympt√¥mes ou posez une question..."
          maxLength={1000}
          showFileUpload
          showVoiceRecord
        />
      </Stack>
    </Container>
  );
};
```

### 2. **Composant de Recommandations**

```typescript
import React from 'react';
import { Grid, Stack } from '@mantine/core';
import { AtomicRecommendationCard, AtomicConfidenceBar } from '../shared/ui';
import { AIRecommendation } from '../shared/types';

interface RecommendationsListProps {
  recommendations: AIRecommendation[];
  onAction?: (action: string, recommendationId: string) => void;
}

export const RecommendationsList: React.FC<RecommendationsListProps> = ({
  recommendations,
  onAction,
}) => {
  const averageConfidence = recommendations.reduce(
    (sum, rec) => sum + rec.confidence, 0
  ) / recommendations.length;

  return (
    <Stack gap="lg">
      {/* Barre de confiance globale */}
      <AtomicConfidenceBar
        confidence={averageConfidence}
        variant="gradient"
        size="lg"
        showLabel
        showValue
        animated
      />

      {/* Grille de recommandations */}
      <Grid>
        {recommendations.map((recommendation) => (
          <Grid.Col key={recommendation.id} span={{ base: 12, md: 6, lg: 4 }}>
            <AtomicRecommendationCard
              recommendation={recommendation}
              variant="actionable"
              size="md"
              showConfidence
              showCategory
              showUrgency
              onAction={onAction}
            />
          </Grid.Col>
        ))}
      </Grid>
    </Stack>
  );
};
```

## üß™ Tests des Composants Atomiques AI Doctor

### 1. **Test d'AtomicMessage**

```typescript
import { render, screen, fireEvent } from '@testing-library/react';
import { AtomicMessage } from '../shared/ui/AtomicMessage';

describe('AtomicMessage', () => {
  const mockMessage = {
    id: '1',
    content: 'Test message',
    role: 'assistant' as const,
    timestamp: new Date(),
  };

  it('renders message content correctly', () => {
    render(<AtomicMessage message={mockMessage} />);
    expect(screen.getByText('Test message')).toBeInTheDocument();
  });

  it('shows avatar for assistant messages', () => {
    render(<AtomicMessage message={mockMessage} showAvatar />);
    expect(screen.getByText('IA Assistant')).toBeInTheDocument();
  });

  it('calls onRetry when retry button is clicked', () => {
    const onRetry = jest.fn();
    render(<AtomicMessage message={mockMessage} onRetry={onRetry} />);

    const retryButton = screen.getByTitle('Ressayer');
    fireEvent.click(retryButton);

    expect(onRetry).toHaveBeenCalledWith('1');
  });
});
```

### 2. **Test d'AtomicChatInput**

```typescript
import { render, screen, fireEvent } from '@testing-library/react';
import { AtomicChatInput } from '../shared/ui/AtomicChatInput';

describe('AtomicChatInput', () => {
  const mockProps = {
    value: '',
    onChange: jest.fn(),
    onSend: jest.fn(),
  };

  it('renders input field correctly', () => {
    render(<AtomicChatInput {...mockProps} />);
    expect(screen.getByPlaceholderText('Tapez votre message...')).toBeInTheDocument();
  });

  it('calls onSend when send button is clicked', () => {
    render(<AtomicChatInput {...mockProps} value="Test message" />);

    const sendButton = screen.getByTitle('Envoyer le message');
    fireEvent.click(sendButton);

    expect(mockProps.onSend).toHaveBeenCalled();
  });

  it('shows character count when maxLength is set', () => {
    render(<AtomicChatInput {...mockProps} maxLength={100} value="Test" />);
    expect(screen.getByText('4/100')).toBeInTheDocument();
  });
});
```

## üöÄ Avantages

### 1. **Coh√©rence Globale**

- ‚úÖ **Types standardis√©s** pour toutes les interactions IA
- ‚úÖ **Composants uniformes** dans toute l'application
- ‚úÖ **Terminologie coh√©rente** pour les recommandations et analyses
- ‚úÖ **Design system** unifi√© pour l'IA

### 2. **Maintenabilit√©**

- ‚úÖ **Types TypeScript** stricts et document√©s
- ‚úÖ **Composants modulaires** et r√©utilisables
- ‚úÖ **Props bien d√©finies** avec valeurs par d√©faut
- ‚úÖ **S√©paration des responsabilit√©s** claire

### 3. **Extensibilit√©**

- ‚úÖ **Architecture modulaire** facile √† √©tendre
- ‚úÖ **Types g√©n√©riques** pour de nouveaux types d'IA
- ‚úÖ **Composants configurables** pour diff√©rents cas d'usage
- ‚úÖ **Hooks personnalis√©s** pour la logique m√©tier

### 4. **Performance**

- ‚úÖ **Composants optimis√©s** avec React.memo si n√©cessaire
- ‚úÖ **Rendu conditionnel** pour les √©l√©ments optionnels
- ‚úÖ **Styles CSS-in-JS** optimis√©s
- ‚úÖ **Bundle splitting** naturel

### 5. **Exp√©rience Utilisateur**

- ‚úÖ **Interface intuitive** pour les interactions IA
- ‚úÖ **Feedback visuel** pour les √©tats de chargement
- ‚úÖ **Accessibilit√©** avec ARIA et navigation clavier
- ‚úÖ **Responsive design** pour tous les appareils

## üîÆ Am√©liorations Futures

### 1. **Nouveaux Composants Atomiques**

- üîÆ **AtomicVoiceRecorder** - Enregistrement vocal avanc√©
- üîÆ **AtomicFilePreview** - Pr√©visualisation de fichiers
- üîÆ **AtomicAnalysisChart** - Graphiques d'analyse IA
- üîÆ **AtomicRecommendationTimeline** - Timeline des recommandations
- üîÆ **AtomicAIFeedback** - Syst√®me de feedback IA

### 2. **Fonctionnalit√©s Avanc√©es**

- üîÆ **Reconnaissance vocale** en temps r√©el
- üîÆ **Analyse d'images** m√©dicales
- üîÆ **Pr√©dictions** bas√©es sur l'historique
- üîÆ **Personnalisation** des recommandations
- üîÆ **Int√©gration** avec d'autres syst√®mes de sant√©

### 3. **Outils de D√©veloppement**

- üîÆ **Storybook** pour tous les composants IA
- üîÆ **Tests d'int√©gration** avec l'IA
- üîÆ **Documentation interactive** avec exemples
- üîÆ **G√©n√©rateur de composants** automatis√©

### 4. **Int√©gration Avanc√©e**

- üîÆ **WebSockets** pour les r√©ponses en temps r√©el
- üîÆ **Streaming** des r√©ponses IA
- üîÆ **Cache intelligent** des recommandations
- üîÆ **Synchronisation** multi-appareils

## üìä Composants Cr√©√©s

### ‚úÖ **Types Cr√©√©s (25/25)**

- [x] **ChatMessage** - Messages de chat IA
- [x] **ChatFile** - Fichiers de chat
- [x] **AIRecommendation** - Recommandations IA
- [x] **AIAnalysis** - Analyses IA
- [x] **MessageProps** - Props des messages
- [x] **ChatInputProps** - Props des entr√©es de chat
- [x] **FileListProps** - Props des listes de fichiers
- [x] **FileItemProps** - Props des √©l√©ments de fichier
- [x] **ChatHeaderProps** - Props des en-t√™tes de chat
- [x] **ChatContainerProps** - Props des conteneurs de chat
- [x] **RecommendationCardProps** - Props des cartes de recommandation
- [x] **RecommendationListProps** - Props des listes de recommandations
- [x] **ConfidenceBarProps** - Props des barres de confiance
- [x] **AnalysisSummaryProps** - Props des r√©sum√©s d'analyse
- [x] **AnalysisHistoryProps** - Props de l'historique d'analyses
- [x] **ChatState** - √âtat du chat
- [x] **ChatActions** - Actions du chat
- [x] **AIAnalysisState** - √âtat des analyses IA
- [x] **AIAnalysisActions** - Actions des analyses IA
- [x] **UseAIChatReturn** - Retour du hook chat IA
- [x] **UseAIAnalysisReturn** - Retour du hook analyse IA
- [x] **ChatUtils** - Utilitaires de chat
- [x] **AIUtils** - Utilitaires IA
- [x] **ChatExport** - Export de chat
- [x] **AnalysisReport** - Rapports d'analyse

### ‚úÖ **Composants Cr√©√©s (4/4)**

- [x] **AtomicMessage** - Message de chat atomique
- [x] **AtomicChatInput** - Entr√©e de chat atomique
- [x] **AtomicRecommendationCard** - Carte de recommandation atomique
- [x] **AtomicConfidenceBar** - Barre de confiance atomique

### ‚úÖ **Int√©gration Technique (4/4)**

- [x] **Types export√©s** dans index.ts
- [x] **Composants export√©s** dans ui/index.ts
- [x] **Documentation compl√®te** cr√©√©e
- [x] **Exemples d'utilisation** fournis

## üéâ **R√©sultat Final**

**L'architecture de types et composants atomiques AI Doctor est maintenant compl√®te et fonctionnelle !**

- ‚úÖ **Types TypeScript** stricts et document√©s pour l'IA
- ‚úÖ **Composants atomiques** r√©utilisables et configurables
- ‚úÖ **Architecture modulaire** et extensible
- ‚úÖ **Design system** coh√©rent pour l'IA
- ‚úÖ **Documentation exhaustive** avec exemples
- ‚úÖ **Tests de base** impl√©ment√©s
- ‚úÖ **Int√©gration technique** parfaite

L'application dispose maintenant d'une **base solide et √©volutive** pour tous les composants d'intelligence artificielle en sant√© ! ü§ñ‚ö°‚ú®

---

_Documentation cr√©√©e le 25/01/2025 - Types et Composants Atomiques AI Doctor Limitless Health_
